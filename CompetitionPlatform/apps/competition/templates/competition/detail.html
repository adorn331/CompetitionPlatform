{% extends 'competition/base.html' %}

{% block content %}
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
  <legend align="center">{{competition.name}}   参赛者及其提交</legend>
</fieldset>

<table class="layui-table" lay-size="sm">
  <colgroup>
    <col width="200">
    <col width="120">
    <col width="200">
    <col>
  </colgroup>

  <thead>
    <tr>
      <th>参赛者考号</th>
      <th>姓名</th>
      <th>状态</th>
      <th>操作</th>
    </tr>
  </thead>

  <tbody>
  {% for p in participants %}
    <tr>

    <td>{{ p.pno }}</td>
    <td>{{ p.name }}</td>

    {% if p.submission %}
        <td>{{p.submission.status}}</td>
    {% else %}
        <td>未提交</td>
    {% endif %}

    <td>
      {% if p.submission %}
      <a href="http://{{ domain }}/media/{{ p.submission.bundle  }}" class="layui-btn layui-btn-xs"><i class="layui-icon layui-icon-download-circle"></i>原始提交</a>
      <a href="http://{{ domain }}/media/{{ p.submission.filtered_bundle  }}" class="layui-btn layui-btn-xs"><i class="layui-icon layui-icon-download-circle"></i>过滤后</a>
      <button type="button" class="layui-btn layui-btn-primary layui-btn-xs layui-btn-disabled" id="upload{{ p.id }}"><i class="layui-icon layui-icon-upload"></i>上传</button>
      {% else %}
      <a href="http://{{ domain }}/media/{{ p.submission.bundle  }}" class="layui-btn layui-btn-xs layui-btn-disabled"><i class="layui-icon layui-icon-download-circle"></i>原始提交</a>
      <a href="http://{{ domain }}/media/{{ p.submission.bundle  }}" class="layui-btn layui-btn-xs layui-btn-disabled"><i class="layui-icon layui-icon-download-circle"></i>过滤后</a>
      <button type="button" class="layui-btn layui-btn-primary layui-btn-xs" id="upload{{ p.id }}"><i class="layui-icon layui-icon-upload"></i>上传</button>
      {% endif %}

      <a href="" class="layui-btn layui-btn-xs layui-btn-disabled">提交详情预览</a>
    </td>

    </tr>
  {% endfor %}
  </tbody>

</table>

{% endblock %}

{% block js %}
<script>
    layui.use('upload', function() {
        var $ = layui.jquery
            , upload = layui.upload, layer = layui.layer;

        {% for p in participants %}
        upload.render({ //允许上传的文件后缀
            elem: '#upload{{ p.id }}'
            , url: 'http://{{ domain }}/submission/create?pno={{ p.pno }}&cname={{competition.name}}'
            , accept: 'file' //普通文件
            , exts: 'zip|rar|7z|tar|tar.gz' //只允许上传压缩文件
            , done: function (res) {
                layer.msg('上传成功');
                console.log(res);
                location.reload();
            }
        });
        {% endfor %}

    });
</script>
{% endblock %}
